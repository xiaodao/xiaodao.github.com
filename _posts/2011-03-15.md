---
layout: post
title: 依赖快捷键做重构是不行的
category: 敏捷开发
tags: [agile, refactoring, ]
---
今天pair的时候，发现一个方法写的有问题，需要传一个参数进来。原来的方法是这样写的：
<pre>public void methodA(){
    blablabla...
}
</pre>
于是我在方法的下面开始写：
<pre>public void methodA2(String param){
    blablabla...
}</pre>
这时候被pair拦住了，他问到，为什么我们不直接就在原来的方法上面改呢，用Ctrl+F6不就能修改方法签名么？

嗯，这是个很常见的情况。我从前也是这样处理的。

然而它有什么问题呢？

让我们算一笔账吧，假如这个方法有5个调用的地方，如果我在原先的方法上直接加一个参数，那就应该有10来个地方（包括单元测试）在IDE上显示刺眼的红色，于是我只有把这些地方逐一改完，才能体面的让编译通过，跑所有的测试，以此来验证重构后的方法是否完成了它应有的功能。

从开始改方法到最后能够把测试全部通过，这段时间想必不会很短——我不知道它到底会有多长，姑且算是一两个小时吧。那么，对于所谓的“小步快走”来说，这个步子是不是略嫌太大了呢？

那就换一种方式吧。假如要修改methodA()这个方法，先新写一个methodA2(string param)，把methodA里面的实现全复制到methodA2里面去，把对新参数的处理也加上，然后找出methodA的所有调用点，逐一替换成调用methodA2。每替换掉一个，就跑一下对应的单元测试。直到所有的地方全都替换结束。最后我就可以把原来的methodA删掉，再把methodA2重命名为methodA了。

在这种工作方式下，每一个步骤都可以在分分钟内完成，于是每隔几分钟就可以通过测试来获得对修改结果的反馈，而不是直到最后一刻，等所有代码都能编译通过以后，才愕然发现很多单元测试都扎上了红红的蝴蝶结等着你。

背熟了每一个重构手法背后的每一个步骤，才能做到真正的小步快走。重构不是IDE上的一个个快捷键，从来都不是。

如果你看到了这篇文章，如果你发现自己对重构的了解只是模模糊糊的概念，根本不知道常用的那些快捷键背后对应的安全手法是什么，那么请翻开书，认认真真的从头读到尾。如果能够把例题按照书上的描述也做上一遍就更好了。（等你看到了add paramter这一节，你会发现我也跳过了一个步骤）

前些天，我开始用TextMate来写一个rails应用的时候，从前练习重构手法所付出的时间，换来了更大的回报。